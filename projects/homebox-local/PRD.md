# HomeBox Local - 产品需求文档 (PRD)

**版本**: 1.0
**日期**: 2026-02-21
**作者**: HOC & 主人

---

## 1. 产品概述

### 1.1 产品定位

HomeBox Local 是一款**纯本地版**智能家庭收纳管理应用。与云版本不同，它采用无服务器架构：
- **数据存储**：100% 存储在用户手机本地
- **AI 能力**：通过第三方 API（GLM-4V、Claude、GPT-4V 等）实现
- **零服务器**：无需部署、无需维护后端

### 1.2 核心价值

| 价值点 | 描述 |
|--------|------|
| 🔒 **极致隐私** | 数据从不离开用户设备，照片、物品信息完全本地存储 |
| 💰 **零运维成本** | 无需服务器、无需数据库、无需云存储费用 |
| ⚡ **极速响应** | 本地数据库查询，毫秒级响应 |
| 📱 **开箱即用** | 下载即用，无需注册账号 |
| 🌙 **离线友好** | 基础功能完全离线可用 |

### 1.3 目标用户

| 用户群体 | 痛点 | 解决方案 |
|----------|------|----------|
| 隐私敏感用户 | 不信任云服务，不愿上传家庭照片 | 数据完全本地存储 |
| 小户型住户 | 物品多、空间小，找不到东西 | 拍照记录，AI 识别 |
| 收纳爱好者 | 需要系统化管理收纳 | 可视化收纳系统 |
| 老年人 | 记忆力下降，经常找不到物品 | 对话式查询 |
| 搬家频繁者 | 每次搬家后物品混乱 | 快速记录、轻松查找 |
| 技术小白 | 不会搭建服务器 | 开箱即用，无需配置 |

---

## 2. 架构设计

### 2.1 与云版本对比

| 特性 | 云版本 (HomeBox) | 本地版本 (HomeBox Local) |
|------|-----------------|-------------------------|
| 后端服务 | FastAPI + PostgreSQL | 无 |
| 数据存储 | 云端数据库 | SQLite / 本地文件 |
| 照片存储 | 阿里云 OSS | 本地文件系统 |
| 用户认证 | 需要注册登录 | 无需登录 |
| 多设备同步 | 自动同步 | 手动导出/导入 |
| AI 服务 | 自建 VLM 服务 | 第三方 API |
| 离线使用 | 需要网络 | 基础功能离线可用 |
| 部署复杂度 | 高（需要服务器） | 零（纯客户端） |
| 使用成本 | 服务器费用 | API 调用费用 |

### 2.2 技术架构

```
┌─────────────────────────────────────────────────────────┐
│                    HomeBox Local App                     │
├─────────────────────────────────────────────────────────┤
│  Flutter App (Android / iOS / 鸿蒙)                      │
│  ├── UI Layer (Riverpod State Management)               │
│  ├── Business Logic Layer                               │
│  │   ├── Box Service (箱子管理)                          │
│  │   ├── Item Service (物品管理)                         │
│  │   ├── Search Service (搜索)                           │
│  │   └── AI Service (AI 识别/对话)                       │
│  ├── Data Layer                                         │
│  │   ├── SQLite (本地数据库)                             │
│  │   ├── File Storage (照片存储)                         │
│  │   └── Secure Storage (API Key 加密存储)              │
│  └── External APIs                                      │
│      ├── GLM-4V API (智谱 AI)                           │
│      ├── Claude API (Anthropic)                         │
│      ├── GPT-4V API (OpenAI)                            │
│      └── 其他兼容 API                                   │
└─────────────────────────────────────────────────────────┘
```

### 2.3 数据模型

```sql
-- 箱子表
CREATE TABLE boxes (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    location_id TEXT,
    photo_path TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 物品表
CREATE TABLE items (
    id TEXT PRIMARY KEY,
    box_id TEXT NOT NULL,
    name TEXT NOT NULL,
    category TEXT,
    quantity INTEGER DEFAULT 1,
    photo_path TEXT,
    notes TEXT,
    tags TEXT,  -- JSON array
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (box_id) REFERENCES boxes(id)
);

-- 位置表
CREATE TABLE locations (
    id TEXT PRIMARY KEY,
    room TEXT NOT NULL,        -- 房间：客厅、卧室、厨房...
    furniture TEXT,            -- 家具：衣柜、抽屉、架子...
    position TEXT,             -- 位置：顶层、左侧、第二层...
    photo_path TEXT,
    notes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 搜索历史
CREATE TABLE search_history (
    id TEXT PRIMARY KEY,
    query TEXT NOT NULL,
    result_summary TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- AI 对话历史
CREATE TABLE chat_history (
    id TEXT PRIMARY KEY,
    role TEXT NOT NULL,  -- user / assistant
    content TEXT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 设置表
CREATE TABLE settings (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

---

## 3. 核心功能

### 3.1 收纳记录流程

```
用户操作                    系统处理
   │
   ├─→ 拍摄箱内物品照片
   │      │
   │      └─→ 调用 VLM API 识别物品
   │             │
   │             ├─→ 识别物品名称、数量、类别
   │             └─→ 返回结构化数据
   │
   ├─→ 用户确认/修改识别结果
   │      │
   │      └─→ 保存到本地数据库 + 照片存本地
   │
   ├─→ 拍摄箱子存放位置
   │      │
   │      └─→ 调用 VLM API 识别位置
   │             │
   │             └─→ 返回：房间、家具、具体位置
   │
   └─→ 完成 ✓
```

### 3.2 功能清单

#### 📦 箱子管理
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 创建箱子 | 拍照识别 + 手动输入 | P0 |
| 编辑箱子 | 修改名称、位置、描述 | P0 |
| 删除箱子 | 删除箱子及关联物品 | P0 |
| 箱子列表 | 按位置/时间/名称排序 | P0 |
| 箱子详情 | 查看箱内物品清单 | P0 |
| 批量导入 | 从相册批量导入照片 | P1 |
| 箱子标签 | 自定义标签分类 | P1 |

#### 📋 物品管理
| 功能 | 描述 | 优先级 |
|------|------|--------|
| AI 识别 | 拍照自动识别物品 | P0 |
| 手动添加 | 手动输入物品信息 | P0 |
| 编辑物品 | 修改名称、数量、标签 | P0 |
| 删除物品 | 删除单个物品 | P0 |
| 物品分类 | 自动分类 + 手动调整 | P0 |
| 物品标签 | 自定义标签系统 | P1 |
| 物品照片 | 每个物品可有多张照片 | P1 |
| 过期提醒 | 设置物品过期/保质期 | P2 |

#### 🔍 搜索查询
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 关键词搜索 | 按名称/标签搜索 | P0 |
| AI 对话搜索 | 自然语言查询 | P0 |
| 位置筛选 | 按房间/家具筛选 | P0 |
| 搜索历史 | 记录常用搜索 | P1 |
| 语音搜索 | 语音输入查询 | P2 |

#### 🤖 AI 功能
| 功能 | 描述 | 优先级 |
|------|------|--------|
| 物品识别 | VLM 识别照片中的物品 | P0 |
| 位置识别 | VLM 识别箱子存放位置 | P0 |
| 对话查询 | LLM 理解自然语言查询 | P0 |
| 智能建议 | AI 建议收纳位置 | P1 |
| 智能分类 | AI 自动分类物品 | P1 |

#### ⚙️ 设置
| 功能 | 描述 | 优先级 |
|------|------|--------|
| API 配置 | 配置 AI API 密钥 | P0 |
| 模型选择 | 选择使用的 AI 模型 | P0 |
| 数据备份 | 导出数据到文件 | P0 |
| 数据恢复 | 从备份文件恢复 | P0 |
| 主题切换 | 浅色/深色模式 | P1 |
| 语言设置 | 多语言支持 | P2 |

---

## 4. 扩展需求分析

### 4.1 用户潜在需求

基于用户场景分析，以下是可能的需求扩展：

#### 🔄 数据同步需求
| 需求 | 场景 | 解决方案 |
|------|------|----------|
| 多设备同步 | 手机 + 平板都要用 | iCloud / Google Drive 同步 |
| 家庭共享 | 和家人共享收纳数据 | 导出分享 + 二维码导入 |
| 数据迁移 | 换手机时迁移数据 | 完整备份/恢复功能 |

#### 📊 管理增强需求
| 需求 | 场景 | 解决方案 |
|------|------|----------|
| 统计分析 | 想知道自己有多少物品 | 物品统计面板 |
| 空间管理 | 了解各个位置的利用率 | 位置容量管理 |
| 过期管理 | 食品、药品等有保质期 | 过期提醒功能 |
| 借出管理 | 借给朋友的东西忘记收回 | 借出记录功能 |

#### 🎯 效率提升需求
| 需求 | 场景 | 解决方案 |
|------|------|----------|
| 快速记录 | 收纳时不想逐个拍照 | 批量拍照 + 后续整理 |
| 模板复用 | 类似箱子重复录入 | 箱子模板功能 |
| 语音输入 | 手不方便时记录 | 语音转文字 |
| 快捷操作 | 频繁使用的操作 | 自定义快捷方式 |

#### 🔔 智能提醒需求
| 需求 | 场景 | 解决方案 |
|------|------|----------|
| 换季提醒 | 该整理换季衣物了 | 季节性提醒 |
| 位置提醒 | 长时间未整理的位置 | 定期提醒检查 |
| 物品提醒 | 重要物品位置提醒 | 自定义提醒 |

#### 📤 分享协作需求
| 需求 | 场景 | 解决方案 |
|------|------|----------|
| 分享清单 | 给家人看物品清单 | 导出 PDF/图片 |
| 协作管理 | 家人共同维护 | 多用户模式（本地） |
| 搬家分享 | 搬家时分享箱子位置 | 二维码/链接分享 |

### 4.2 隐私安全需求

| 需求 | 描述 | 实现方案 |
|------|------|----------|
| API Key 安全 | API 密钥不能明文存储 | 系统级安全存储 |
| 照片隐私 | 照片可能包含敏感信息 | 应用级加密（可选） |
| 数据备份加密 | 备份文件可能泄露 | 加密备份（可选） |
| 生物识别锁定 | 防止他人查看 | 指纹/面容解锁 |

---

## 5. AI 服务配置

### 5.1 支持的 AI 服务

| 服务商 | 模型 | 用途 | 价格参考 |
|--------|------|------|----------|
| 智谱 AI | GLM-4V | 物品/位置识别 | ¥0.01/次 |
| 智谱 AI | GLM-4 | 对话查询 | ¥0.01/千tokens |
| Anthropic | Claude 3.5 | 物品识别+对话 | $0.003/次 |
| OpenAI | GPT-4V | 物品/位置识别 | $0.01/次 |
| OpenAI | GPT-4 | 对话查询 | $0.03/千tokens |
| 通义千问 | Qwen-VL | 物品/位置识别 | ¥0.008/次 |

### 5.2 API 配置界面设计

```
┌─────────────────────────────────────┐
│  AI 服务设置                         │
├─────────────────────────────────────┤
│  选择 AI 服务商:                     │
│  ○ 智谱 AI (GLM-4V)                 │
│  ○ Anthropic (Claude 3.5)           │
│  ○ OpenAI (GPT-4V)                  │
│  ○ 通义千问 (Qwen-VL)               │
│  ○ 自定义 API (兼容 OpenAI 格式)    │
├─────────────────────────────────────┤
│  API 密钥:                          │
│  [•••••••••••••••••••] [显示]       │
│                                     │
│  API 地址 (可选):                    │
│  [https://api.example.com/v1     ]  │
│                                     │
│  模型选择:                          │
│  [glm-4v                    ▼]      │
│                                     │
│  [测试连接]  [保存]                  │
└─────────────────────────────────────┘
```

### 5.3 成本估算

假设用户每月：
- 新增 20 个箱子，每箱 2 张照片（物品+位置）= 40 次 VLM 调用
- 对话查询 50 次

使用智谱 AI 的月成本：
- VLM 识别：40 × ¥0.01 = ¥0.4
- 对话查询：50 × ¥0.005（平均） = ¥0.25
- **月成本约 ¥0.65**

---

## 6. UI/UX 设计要点

### 6.1 核心页面

```
首页
├── 📷 快速记录 (FAB)
├── 🔍 搜索栏
├── 📍 按位置浏览
│   ├── 客厅 (3 个箱子)
│   ├── 卧室 (5 个箱子)
│   └── ...
└── 🕐 最近记录

箱子详情页
├── 📸 箱子照片
├── 📍 位置信息
├── 📋 物品清单
└── ✏️ 编辑/删除

搜索页
├── 💬 对话搜索
├── 📝 关键词搜索
└── 📜 搜索历史
```

### 6.2 设计原则

1. **一键记录** - 从打开 App 到完成记录，最多 3 步
2. **离线优先** - 核心功能无需网络
3. **大字体** - 考虑老年用户
4. **高对比度** - 各种光线环境下清晰可见

---

## 7. 技术选型

### 7.1 技术栈

| 层级 | 技术 | 说明 |
|------|------|------|
| 框架 | Flutter 3.27+ | 跨平台开发 |
| 状态管理 | Riverpod | 响应式状态管理 |
| 数据库 | SQLite (sqflite) | 本地数据库 |
| 图片存储 | path_provider | 应用私有目录 |
| 安全存储 | flutter_secure_storage | API Key 加密存储 |
| HTTP | Dio | API 请求 |
| 图片选择 | image_picker | 拍照/相册 |

### 7.2 目录结构

```
homebox-local/
├── lib/
│   ├── main.dart
│   ├── app.dart
│   ├── core/
│   │   ├── database/
│   │   │   ├── database.dart
│   │   │   ├── boxes_dao.dart
│   │   │   └── items_dao.dart
│   │   ├── storage/
│   │   │   ├── photo_storage.dart
│   │   │   └── secure_storage.dart
│   │   ├── network/
│   │   │   ├── api_client.dart
│   │   │   └── ai_service.dart
│   │   └── router/
│   │       └── app_router.dart
│   ├── features/
│   │   ├── home/
│   │   ├── box/
│   │   ├── item/
│   │   ├── search/
│   │   ├── chat/
│   │   └── settings/
│   └── shared/
│       ├── widgets/
│       └── theme/
├── test/
├── android/
├── ios/
├── ohos/
└── pubspec.yaml
```

---

## 8. 开发计划

### Phase 1: 基础功能 (2周)
- [ ] 项目初始化
- [ ] 数据库设计与实现
- [ ] 箱子管理 (CRUD)
- [ ] 物品管理 (CRUD)
- [ ] 基础 UI

### Phase 2: AI 集成 (1周)
- [ ] AI 服务配置界面
- [ ] VLM 物品识别
- [ ] VLM 位置识别
- [ ] LLM 对话查询

### Phase 3: 完善功能 (1周)
- [ ] 搜索功能
- [ ] 数据备份/恢复
- [ ] 设置页面
- [ ] UI 优化

### Phase 4: 测试发布 (1周)
- [ ] 单元测试
- [ ] 集成测试
- [ ] Android APK 构建
- [ ] iOS 构建（如有开发者账号）

---

## 9. 风险与对策

| 风险 | 影响 | 对策 |
|------|------|------|
| API 服务不稳定 | AI 功能不可用 | 多服务商切换 + 离线降级 |
| API 费用上涨 | 用户成本增加 | 支持本地模型（未来） |
| 存储空间不足 | 无法保存照片 | 图片压缩 + 云备份选项 |
| 数据丢失 | 用户数据丢失 | 定期自动备份提醒 |

---

## 10. 未来规划

### 10.1 短期 (3个月内)
- [ ] 鸿蒙版本
- [ ] iCloud/Google Drive 同步
- [ ] 批量导入功能
- [ ] 过期提醒功能

### 10.2 中期 (6个月内)
- [ ] 支持本地 AI 模型（无网络使用）
- [ ] 家庭共享模式
- [ ] Web 版本（PWA）
- [ ] 语音搜索

### 10.3 长期 (1年内)
- [ ] AR 导航（指引物品位置）
- [ ] 智能收纳建议
- [ ] 物品价值评估

---

**GitHub**: https://github.com/huweiopenclaw/homebox-local

**Made with ❤️ by HOC**
